# makefile of swooz-avatar project using Visual C++
# Florian Lance
# lyon sept 2013

!IF "$(CFG)" != "Release" &&  "$(CFG)" != "Debug"
!ERROR Invalid CFG "($CFG)
!ENDIF

!IF "$(ARCH)" != "x86" &&  "$(ARCH)" != "amd64"
!ERROR Invalid ARCH "($ARCH)
!ENDIF

CC=cl
LINK=link

!INCLUDE <./makefile-include>

############################################################################## Makefile commands

# Files to be generated by the x86 compilation mode
!if  "$(ARCH)" == "x86"
all: $(BINDIR)/kinect_display.exe $(BINDIR)/kinect_thread_display.exe $(BINDIR)/kinect_data_saver.exe $(BINDIR)/kinect_data_loader.exe $(BINDIR)/detect_face_stasm.exe
!endif

# Files to be generated by the amd64 compilation mode
!if "$(ARCH)" == "amd64"
all:
!endif


############################################################################## obj Files

################################## dynamic

$(LIBDIR)/display_kinect_main_d.obj: ./display_kinect_main.cpp
        $(CC) -c ./display_kinect_main.cpp $(CFLAGS_DYN) $(INC_MAIN_DISPLAY_KINECT) -Fo"$(LIBDIR)/display_kinect_main_d.obj"

$(LIBDIR)/display_kinect_thread_main_d.obj: ./display_kinect_thread_main.cpp
        $(CC) -c ./display_kinect_thread_main.cpp $(CFLAGS_DYN) $(INC_MAIN_DISPLAY_THREAD_KINECT) -Fo"$(LIBDIR)/display_kinect_thread_main_d.obj"

$(LIBDIR)/kinect_data_saver_main_d.obj: ./kinect_data_saver_main.cpp
        $(CC) -c ./kinect_data_saver_main.cpp $(CFLAGS_DYN) $(INC_MAIN_DATA_SAVER_KINECT) -Fo"$(LIBDIR)/kinect_data_saver_main_d.obj"

$(LIBDIR)/kinect_data_loader_main_d.obj: ./kinect_data_loader_main.cpp
        $(CC) -c ./kinect_data_loader_main.cpp $(CFLAGS_DYN) $(INC_MAIN_DATA_LOADER_KINECT) -Fo"$(LIBDIR)/kinect_data_loader_main_d.obj"


$(LIBDIR)/detect_face_stasm_main_d.obj: ./detect_face_stasm_main.cpp
        $(CC) -c ./detect_face_stasm_main.cpp $(CFLAGS_DYN) $(INC_MAIN_DETECT_FACE_STASM) -Fo"$(LIBDIR)/detect_face_stasm_main_d.obj"


############################################################################## exe files

WIN_CONFIG = $(SETARGV) $(BINMODE) $(WINLIBS)

# exec files to be generated
$(BINDIR)/kinect_display.exe: $(LIBDIR)/display_kinect_main_d.obj $(LIBS_MAIN_DISPLAY_KINECT)
        $(LINK) /OUT:$(BINDIR)/kinect_display.exe $(LFLAGS) $(LIBDIR)/display_kinect_main_d.obj $(LIBS_MAIN_DISPLAY_KINECT) $(WIN_CONFIG)

$(BINDIR)/kinect_thread_display.exe: $(LIBDIR)/display_kinect_thread_main_d.obj $(LIBS_MAIN_DISPLAY_THREAD_KINECT)
        $(LINK) /OUT:$(BINDIR)/kinect_thread_display.exe $(LFLAGS) $(LIBDIR)/display_kinect_thread_main_d.obj $(LIBS_MAIN_DISPLAY_THREAD_KINECT) $(WIN_CONFIG)

$(BINDIR)/kinect_data_saver.exe: $(LIBDIR)/kinect_data_saver_main_d.obj $(LIBS_MAIN_DATA_SAVER_KINECT)
        $(LINK) /OUT:$(BINDIR)/kinect_data_saver.exe $(LFLAGS) $(LIBDIR)/kinect_data_saver_main_d.obj $(LIBS_MAIN_DATA_SAVER_KINECT) $(WIN_CONFIG)

$(BINDIR)/kinect_data_loader.exe: $(LIBDIR)/kinect_data_loader_main_d.obj $(LIBS_MAIN_DATA_LOADER_KINECT)
        $(LINK) /OUT:$(BINDIR)/kinect_data_loader.exe $(LFLAGS) $(LIBDIR)/kinect_data_loader_main_d.obj $(LIBS_MAIN_DATA_LOADER_KINECT) $(WIN_CONFIG)

$(BINDIR)/detect_face_stasm.exe: $(LIBDIR)/detect_face_stasm_main_d.obj $(LIBS_MAIN_DETECT_FACE_STASM)
        $(LINK) /OUT:$(BINDIR)/detect_face_stasm.exe $(LFLAGS) $(LIBDIR)/detect_face_stasm_main_d.obj $(LIBS_MAIN_DETECT_FACE_STASM) $(WIN_CONFIG)
